<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../paper-rating/paper-rating.html">


<dom-module id="grid-image">

  <style>
    :host {
      background-image: url(http://lorempixel.com/300/300);
      background-size:contain;
    }

    .grid-image-class {
      position: relative;
      height: 100%;
    }

    .title {
      text-align: right;
      font-size: 20px;
    }

    .bottom {
      color: #ffffff;
      position: absolute;
      bottom: 16px;
      right: 0;
      margin-bottom: 8px;
      padding-right: 8px;
    }

    .rating {
      color: #ffffff;
      position: absolute;
      bottom: 0;
      right: 0;
      margin-bottom: 8px;
      padding-right: 8px;
    }
  </style>

  <template>
    <a id="linkPlace" href="{{src}}" hidden$="1"></a>
    <div id="gridImage" class="grid-image-class">
      <div class="bottom">
        <div class="title">{{title}}</div>
      </div>
      <template is="dom-if" if="{{rate}}">
        <div class="rating">
          <paper-rating rate="{{rate}}" readonly></paper-rating>
        </div>
      </template>
    </div>
  </template>
</dom-module>

<script>

  (function () {

    Polymer({

      is: 'grid-image',

      properties: {

        title : {
          type: String
        },

        rate : {
          type: Number
        },

        rewriteClass: {
          type: String,
          notify: true,
          observer: 'classChanged'
        },

        background: {
          type: String,
          value: false,
          observer: 'backgroundChanged'
        },

        src: {
          type: String,
          readOnly: true
        },

        place: {
          type: Object,
          value: {
            "id": 31
          }
        }
      },

      observers: [
        'placeChanged(place)'
      ],

      attached: function () {
        if (this.place) {
          this.style['cursor'] = 'pointer';
          this.updateStyles();

          this.listen(this, 'tap', 'onTap');
        }

      },

      placeChanged: function (place) {
        if (place) {
          this._setSrc('/place/' + place.id);
        }
      },

      onTap: function (e) {
        this.$.linkPlace.click();
      },

      classChanged: function (newValue) {
        if (newValue) {
          this.class = newValue;
        }
      },

      backgroundChanged: function (newValue) {
        if (newValue) {
          this.style.backgroundImage = 'url(' + newValue + ')';
        }
      }

    });

  })();

</script>
